# Ralph Progress Log
Started: Tue Jan 27 18:46:20 CST 2026
---

## Codebase Patterns
- Flask app is monolithic in app.py with routes, use jsonify for JSON responses
- Database is SQLite via tools/db_jobs.py - uses DB_PATH constant
- Environment variables: FLASK_SECRET_KEY, NOC_ENCRYPTION_KEY, NOC_ADMIN_PASSWORD, NOC_TOOLKIT_DB_PATH, NOC_TOOLKIT_DATA_DIR, WLC_DASHBOARD_KEY
- Security functions in tools/security.py - init_security_db(), require_login decorator
- Syntax check: python3 -m py_compile <file>.py
- Requirements layered in requirements/ directory: base.txt -> prod.txt -> dev.txt
- pyproject.toml contains tool configs for black, mypy, pytest, flake8
- New src/ structure: src/blueprints/{domain}/, src/core/, src/models/ - all with __init__.py
- Application factory: src/app.py create_app(config_name) - configs in src/config.py
- Production entry point: wsgi.py calls create_app("production")
- Core utilities in src/core/: database.py, security.py, helpers.py - import via `from src.core import ...`

---

## 2026-01-27 18:47 CST - US-001
- What was implemented:
  - Created Dockerfile with Python 3.11-slim base image
  - Created docker-compose.yml with app and postgres services
  - Created .env.example documenting all environment variables
  - Created docker-entrypoint.sh for database initialization
  - Added /health endpoint in app.py returning {"status": "healthy", "service": "noc-toolkit"}
  - Configured PostgreSQL persistence via named volume (postgres-data)
- Files changed:
  - Dockerfile (new)
  - docker-compose.yml (new)
  - .env.example (new)
  - docker-entrypoint.sh (new)
  - app.py (added health endpoint at line 1847)
- **Learnings for future iterations:**
  - Health endpoint added before /login route at line 1847
  - No pyproject.toml or mypy config exists yet - syntax check via py_compile
  - The app currently uses SQLite; PostgreSQL service is ready but migration happens in later stories
  - Non-root user 'appuser' is created in Docker for security
---

## 2026-01-27 19:02 CST - US-002
- What was implemented:
  - Created requirements/base.txt with core dependencies (Flask, netmiko, cryptography, requests)
  - Created requirements/prod.txt extending base.txt with gunicorn>=21.2.0 and psycopg2-binary>=2.9.9
  - Created requirements/dev.txt extending base.txt with pytest, playwright, black, flake8, mypy
  - Updated Dockerfile to use requirements/prod.txt instead of flat requirements.txt
  - Added pyproject.toml with modern Python project configuration (black, mypy, pytest, flake8 settings)
- Files changed:
  - requirements/base.txt (new)
  - requirements/prod.txt (new)
  - requirements/dev.txt (new)
  - Dockerfile (modified - now copies requirements/ directory and uses prod.txt)
  - pyproject.toml (new)
- **Learnings for future iterations:**
  - pyproject.toml now exists with tool configurations for black, mypy, pytest, flake8
  - Requirements are layered: base.txt (core) -> prod.txt (adds production server) -> dev.txt (adds testing tools)
  - Use `-r base.txt` syntax in requirements files to extend base dependencies
  - The original requirements.txt still exists for backward compatibility but Dockerfile now uses requirements/prod.txt
---

## 2026-01-27 19:15 CST - US-003
- What was implemented:
  - Created README.md with project overview, features list, quick start guide, and project structure
  - Created docs/DEPLOYMENT.md with production deployment guide (Docker, nginx, backups, monitoring, troubleshooting)
  - Created docs/DEVELOPMENT.md with local development setup (venv, running, testing, debugging)
  - Created docs/CONTRIBUTING.md with contribution guidelines (code style, PR process, architecture)
  - Created CHANGELOG.md with version history format and initial release notes
- Files changed:
  - README.md (new)
  - docs/DEPLOYMENT.md (new)
  - docs/DEVELOPMENT.md (new)
  - docs/CONTRIBUTING.md (new)
  - CHANGELOG.md (new)
- **Learnings for future iterations:**
  - Existing docs/ directory already had audit-findings.md and production-runbook.md from previous work
  - Project structure documented: main app.py, tools/ for backend modules, templates/ for Jinja2, static/ for assets
  - Key security decorators: @require_login, @require_superadmin, @require_page_enabled("page-name")
  - Database operations centralized in tools/db_jobs.py
  - pyproject.toml references README.md for project description
---

## 2026-01-27 19:30 CST - US-004
- What was implemented:
  - Created src/ directory as main package with __init__.py
  - Created src/blueprints/ directory with 10 subdirectories: auth/, admin/, wlc/, solarwinds/, config/, bulk_ssh/, certs/, jobs/, kb/, api/
  - Each blueprint directory contains __init__.py for Python package recognition
  - Created src/core/ directory for shared utilities (db, security, helpers) with __init__.py
  - Created src/models/ directory for database models with __init__.py
- Files changed:
  - src/__init__.py (new)
  - src/blueprints/__init__.py (new)
  - src/blueprints/{auth,admin,wlc,solarwinds,config,bulk_ssh,certs,jobs,kb,api}/__init__.py (10 files, new)
  - src/core/__init__.py (new)
  - src/models/__init__.py (new)
- **Learnings for future iterations:**
  - New blueprint structure: src/blueprints/{domain}/ contains routes.py and templates/ subdirectory
  - Shared utilities will go in src/core/ (database.py, security.py, helpers.py)
  - Database models will go in src/models/ (one file per domain)
  - All __init__.py files are currently empty - they will be populated as blueprints are implemented
---

## 2026-01-27 20:15 CST - US-005
- What was implemented:
  - Created src/config.py with configuration classes (Config, DevelopmentConfig, ProductionConfig, TestingConfig)
  - Created src/app.py with create_app(config_name) factory function
  - Created wsgi.py as production entry point that imports and calls create_app("production")
  - Factory function validates SECRET_KEY is required in production mode
  - Health check endpoint at /health in the factory function
  - Error handlers for 404 and 500 registered in factory
- Files changed:
  - src/config.py (new)
  - src/app.py (new)
  - wsgi.py (new)
- **Learnings for future iterations:**
  - Config classes use class attributes with type hints for Flask configuration
  - Production requires FLASK_SECRET_KEY env var - raises RuntimeError if missing
  - get_config(config_name) helper function to retrieve config class by name
  - Factory pattern stubs for _init_extensions() and _register_blueprints() ready for future stories
  - Template/static folders configured relative to src/app.py: "../templates", "../static"
  - wsgi.py exports both `application` and `app` for compatibility with different WSGI servers
---

## 2026-01-27 19:04 CST - US-006
- What was implemented:
  - Created src/core/database.py with database connection management utilities
  - Created src/core/security.py with authentication, encryption, and access control decorators
  - Created src/core/helpers.py with common utility functions (page settings, timezone, formatting)
  - Updated src/core/__init__.py to export all utilities for easy importing
  - All modules use relative imports within the package
- Files changed:
  - src/core/database.py (new)
  - src/core/security.py (new)
  - src/core/helpers.py (new)
  - src/core/__init__.py (modified)
- **Learnings for future iterations:**
  - Import core utilities via: `from src.core import get_connection, require_login, is_page_enabled`
  - database.py: DB_PATH, get_connection(), get_db_lock(), execute_with_lock(), fetch_one(), fetch_all()
  - security.py: encrypt/decrypt_password(), require_login/superadmin/kb_create/page_enabled decorators
  - helpers.py: is_page_enabled(), get_app_timezone(), now_iso(), format_datetime()
  - Encryption key loaded from NOC_ENCRYPTION_KEY env var or .encryption_key file
  - Thread-safe database operations via _DB_LOCK context manager
---

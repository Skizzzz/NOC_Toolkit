{% extends "base.html" %}
{% block title %}{{ article.title }} - Knowledge Base{% endblock %}
{% block head_extra %}
<style>
  .article-header {
    margin-bottom: 28px;
  }
  .article-header h1 {
    margin: 0 0 14px 0;
    font-size: 30px;
    line-height: 1.25;
    font-family: 'Instrument Sans', sans-serif;
    font-weight: 700;
    letter-spacing: -0.02em;
  }
  .article-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 18px;
    align-items: center;
    color: var(--text-muted);
    font-size: 13px;
  }
  .article-meta-item {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .article-meta svg {
    width: 16px;
    height: 16px;
    opacity: 0.6;
  }

  .article-badges {
    display: flex;
    gap: 10px;
    margin-bottom: 18px;
  }
  .subject-badge {
    background: rgba(245,4,80,0.12);
    color: var(--pink);
    padding: 6px 14px;
    border-radius: 999px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  .visibility-badge {
    padding: 6px 14px;
    border-radius: 999px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.04em;
  }
  .visibility-badge.FSR {
    background: rgba(0,214,127,0.12);
    color: var(--success);
  }
  .visibility-badge.NOC {
    background: rgba(59,139,255,0.12);
    color: var(--info);
  }
  .visibility-badge.Admin {
    background: rgba(255,168,38,0.12);
    color: var(--warning);
  }

  .article-content {
    background: var(--card);
    border: 1px solid var(--border-subtle);
    border-radius: 16px;
    padding: 32px;
    position: relative;
    overflow: hidden;
  }
  .article-content::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--pink);
  }
  .article-body {
    font-size: 14px;
    line-height: 1.8;
    color: var(--text);
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .article-actions {
    display: flex;
    gap: 12px;
    margin-top: 28px;
    padding-top: 24px;
    border-top: 1px solid var(--border-subtle);
  }

  .delete-form {
    display: inline;
  }
  .btn-danger {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 20px;
    background: var(--error);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  .btn-danger:hover {
    background: #dc2626;
    transform: translateY(-1px);
  }

  .back-link {
    margin-top: 24px;
  }

  @media (max-width: 768px) {
    .article-header h1 { font-size: 24px; }
    .article-content { padding: 24px; }
  }
</style>
{% endblock %}

{% block content %}
<nav class="breadcrumbs">
  <a href="{{ url_for('index') }}">Dashboard</a>
  <span class="breadcrumbs-separator">/</span>
  <a href="{{ url_for('knowledge_base') }}">Knowledge Base</a>
  <span class="breadcrumbs-separator">/</span>
  <span class="breadcrumbs-current">{{ article.title[:40] }}{% if article.title|length > 40 %}...{% endif %}</span>
</nav>

<div class="article-header">
  <div class="article-badges">
    <span class="subject-badge">{{ article.subject }}</span>
    <span class="visibility-badge {{ article.visibility }}">{{ article.visibility }}</span>
  </div>
  <h1>{{ article.title }}</h1>
  <div class="article-meta">
    <span class="article-meta-item">
      <svg viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
      </svg>
      {{ article.author_name or 'Unknown' }}
    </span>
    <span class="article-meta-item">
      <svg viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
      </svg>
      Created: {{ article.created_at[:16] if article.created_at else 'Unknown' }}
    </span>
    {% if article.updated_at and article.updated_at != article.created_at %}
    <span class="article-meta-item">
      <svg viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
      </svg>
      Updated: {{ article.updated_at[:16] }}
    </span>
    {% endif %}
  </div>
</div>

<div class="article-content">
  <div class="article-body">{{ article.content }}</div>

  {% if can_edit %}
  <div class="article-actions">
    <a href="{{ url_for('knowledge_base_edit', article_id=article.id) }}" class="btn btn-primary">
      <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
        <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
      </svg>
      Edit Article
    </a>
    <form class="delete-form" method="post" action="{{ url_for('knowledge_base_delete', article_id=article.id) }}" onsubmit="return confirm('Are you sure you want to delete this article? This cannot be undone.');">
      <button type="submit" class="btn-danger">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
        </svg>
        Delete
      </button>
    </form>
  </div>
  {% endif %}
</div>

<div class="back-link">
  <a href="{{ url_for('knowledge_base') }}" class="btn">
    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
      <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
    </svg>
    Back to Knowledge Base
  </a>
</div>
{% endblock %}

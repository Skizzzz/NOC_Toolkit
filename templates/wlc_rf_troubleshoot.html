{% extends "base.html" %}
{% block title %}RF Troubleshooter – Polls{% endblock %}
{% block head_extra %}{% endblock %}
{% block content %}
  <nav class="breadcrumbs">
    <a href="{{ url_for('index') }}">Dashboard</a>
    <span class="breadcrumbs-separator">/</span>
    <a href="{{ url_for('wlc_tools') }}">WLC Tools</a>
    <span class="breadcrumbs-separator">/</span>
    <span class="breadcrumbs-current">RF Troubleshooter</span>
  </nav>

  <div class="tool-header">
    <div class="tool-icon">
      <svg width="28" height="28" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z"/>
      </svg>
    </div>
    <h2>RF Troubleshooter (Periodic Polls)</h2>
    <p>Poll a single Cisco 9800 controller at configurable intervals to track RF utilization trends over time. Perfect for troubleshooting intermittent wireless issues by graphing average and peak utilization by frequency band. Results run as background jobs with real-time charting.</p>
  </div>

  <form method="post" action="{{ url_for('wlc_rf_troubleshoot_start') }}">
    <!-- Target Controller Section -->
    <div class="form-section">
      <div class="form-section-header">
        <div class="form-section-icon">
          <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
            <path d="M2 5a2 2 0 012-2h12a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V5z"/>
          </svg>
        </div>
        <div style="flex:1;">
          <h3 class="form-section-title">Target Controller</h3>
          <p class="form-section-subtitle">Specify which WLC to monitor</p>
        </div>
      </div>

      <div class="field">
        <label>
          <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor" style="vertical-align:middle; margin-right:4px;">
            <path d="M2 5a2 2 0 012-2h12a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V5z"/>
          </svg>
          WLC IP / Hostname
        </label>
        <input name="host" type="text" required placeholder="e.g., 10.20.30.40 or wlc-main.domain.com" />
        <div class="muted">This tool monitors one controller per job for accurate time-series data</div>
      </div>
    </div>

    <!-- Authentication Section -->
    <div class="form-section">
      <div class="form-section-header">
        <div class="form-section-icon">
          <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z"/>
          </svg>
        </div>
        <div>
          <h3 class="form-section-title">Authentication</h3>
          <p class="form-section-subtitle">Your network credentials for SSH access</p>
        </div>
      </div>

      <div class="row">
        <div class="field field-with-icon">
          <label>Username</label>
          <svg class="field-icon" width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"/>
          </svg>
          <input name="username" type="text" required placeholder="Enter your network username" />
        </div>
        <div class="field field-with-icon">
          <label>Password</label>
          <svg class="field-icon" width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M18 8a6 6 0 01-7.743 5.743L10 14l-1 1-1 1H6v2H2v-4l4.257-4.257A6 6 0 1118 8zm-6-4a1 1 0 100 2 2 2 0 012 2 1 1 0 102 0 4 4 0 00-4-4z"/>
          </svg>
          <input name="password" type="password" required placeholder="Enter your network password" />
        </div>
        <div class="field">
          <label>Enable Secret <span class="muted">(optional)</span></label>
          <input name="secret" type="password" placeholder="Leave blank if not required" />
          <div class="muted">Only needed if device requires enable mode</div>
        </div>
      </div>
    </div>

    <!-- Polling Configuration Section -->
    <div class="form-section">
      <div class="form-section-header">
        <div class="form-section-icon">
          <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"/>
          </svg>
        </div>
        <div>
          <h3 class="form-section-title">Polling Configuration</h3>
          <p class="form-section-subtitle">Configure how often and how many times to poll</p>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label>
            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor" style="vertical-align:middle; margin-right:4px;">
              <path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z"/>
            </svg>
            Radio Band
          </label>
          <select name="band" class="input">
            <option value="both" selected>Both (2.4 & 5 GHz)</option>
            <option value="5">5 GHz Only</option>
            <option value="2.4">2.4 GHz Only</option>
          </select>
          <div class="muted">Which frequency band(s) to monitor</div>
        </div>
        <div class="field">
          <label>
            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor" style="vertical-align:middle; margin-right:4px;">
              <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1z"/>
            </svg>
            Poll Count
          </label>
          <input name="polls" type="number" min="1" max="999" value="3" required />
          <div class="muted">How many times to poll (auto-trimmed if > 12 hours total)</div>
        </div>
        <div class="field">
          <label>
            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor" style="vertical-align:middle; margin-right:4px;">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"/>
            </svg>
            Polling Interval (seconds)
          </label>
          <input name="interval_sec" type="number" min="120" step="60" placeholder="300" value="300" required />
          <div class="muted">Minimum 120s (2 min). Default 300s (5 min). Recommended: 300-600s</div>
        </div>
      </div>

      <div style="margin-top:16px; padding:12px; background: color-mix(in oklab, var(--warning) 8%, transparent); border-radius:8px; border:1px solid color-mix(in oklab, var(--warning) 20%, transparent);">
        <div style="display:flex; align-items:flex-start; gap:10px;">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="var(--warning)" style="flex-shrink:0; margin-top:2px;">
            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"/>
          </svg>
          <div style="flex:1;">
            <div style="font-weight:600; font-size:13px; margin-bottom:4px; color:var(--warning);">Important Notes</div>
            <div style="font-size:13px; color:var(--muted); line-height:1.5;">
              • This creates a <strong>background job</strong> — you can close this page after starting<br>
              • Total duration is limited to <strong>12 hours maximum</strong><br>
              • View progress and results in the <a href="{{ url_for('wlc_jobs_overview') }}">WLC Jobs page</a><br>
              • Example: 3 polls × 5 min interval = 15 minutes total runtime
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <a class="btn" href="{{ url_for('wlc_jobs_overview') }}">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor" style="margin-right:4px;">
          <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
          <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z"/>
        </svg>
        View Jobs
      </a>
      <button class="btn" type="reset">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor" style="margin-right:4px;">
          <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"/>
        </svg>
        Reset Form
      </button>
      <button class="btn primary" type="submit">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor" style="margin-right:4px;">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"/>
        </svg>
        Start Troubleshooter
      </button>
    </div>
  </form>
{% endblock %}

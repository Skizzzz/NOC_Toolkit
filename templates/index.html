{% extends "base.html" %}
{% block title %}NOC Toolkit — Dashboard{% endblock %}
{% block head_extra %}
<style>
  /* Dashboard Header */
  .dashboard-header {
    margin-bottom: 32px;
  }

  .dashboard-title {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 20px;
    flex-wrap: wrap;
  }

  .dashboard-title h2 {
    font-size: 32px;
    letter-spacing: -0.03em;
    margin-bottom: 8px;
  }

  .dashboard-title .muted {
    font-size: 15px;
    max-width: 600px;
    line-height: 1.5;
  }

  /* Quick Stats Grid */
  .quick-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-bottom: 32px;
  }

  @media (max-width: 1200px) {
    .quick-stats { grid-template-columns: repeat(2, 1fr); }
  }

  @media (max-width: 600px) {
    .quick-stats { grid-template-columns: 1fr; }
  }

  .stat-card {
    background: var(--card);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-lg);
    padding: 24px;
    position: relative;
    overflow: hidden;
    text-decoration: none;
    color: inherit;
    display: block;
    transition: all 0.2s ease;
  }

  .stat-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    border-color: var(--pink);
  }

  /* Pink accent bar on stat cards */
  .stat-card::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    background: var(--pink);
    transition: width 0.2s ease;
  }

  .stat-card:hover::before {
    width: 6px;
  }

  .stat-card.success::before { background: var(--success); }
  .stat-card.warning::before { background: var(--warning); }
  .stat-card.error::before { background: var(--error); }
  .stat-card.info::before { background: var(--info); }

  .stat-icon {
    position: absolute;
    top: 24px;
    right: 24px;
    width: 40px;
    height: 40px;
    opacity: 0.15;
    color: var(--text);
  }

  .stat-label {
    font-family: 'Instrument Sans', sans-serif;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-muted);
    margin-bottom: 12px;
  }

  .stat-value {
    font-family: 'Instrument Sans', sans-serif;
    font-size: 42px;
    font-weight: 700;
    line-height: 1;
    letter-spacing: -0.03em;
    margin-bottom: 8px;
  }

  .stat-subtitle {
    font-size: 13px;
    color: var(--text-muted);
  }

  /* Service Status Section */
  .service-status-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-top: 20px;
  }

  @media (max-width: 900px) {
    .service-status-grid { grid-template-columns: 1fr; }
  }

  .service-card {
    background: var(--bg-subtle);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius);
    padding: 20px;
    text-decoration: none;
    color: inherit;
    display: block;
    transition: all 0.2s ease;
  }

  .service-card:hover {
    transform: translateY(-2px);
    border-color: var(--pink);
    background: var(--card);
  }

  .service-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
  }

  .service-name {
    font-weight: 600;
    font-size: 14px;
  }

  .service-details {
    display: flex;
    flex-direction: column;
    gap: 8px;
    font-size: 13px;
    color: var(--text-muted);
  }

  .service-detail-row {
    display: flex;
    justify-content: space-between;
  }

  .service-detail-row span:last-child {
    color: var(--text);
    font-weight: 500;
  }

  /* Quick Access Tools */
  .tool-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
  }

  .tool-card {
    background: var(--card);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius-lg);
    padding: 24px;
    position: relative;
    overflow: hidden;
    transition: all 0.2s ease;
  }

  .tool-card:hover {
    border-color: var(--pink);
    transform: translateY(-2px);
    box-shadow: var(--shadow);
  }

  /* Geometric corner accent */
  .tool-card::after {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, transparent 50%, var(--accent-soft) 50%);
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  .tool-card:hover::after {
    opacity: 1;
  }

  .tool-card-icon {
    width: 48px;
    height: 48px;
    border-radius: var(--radius);
    background: var(--pink);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    margin-bottom: 18px;
    box-shadow: 0 4px 16px rgba(245, 4, 80, 0.25);
  }

  .tool-card h3 {
    font-size: 17px;
    font-weight: 700;
    margin-bottom: 10px;
  }

  .tool-card p {
    font-size: 13px;
    color: var(--text-muted);
    line-height: 1.5;
    margin-bottom: 18px;
  }

  .tool-card .btn-gradient {
    width: 100%;
    justify-content: center;
  }

  /* Section spacing */
  .dashboard-section {
    margin-bottom: 32px;
  }

  .dashboard-section:last-child {
    margin-bottom: 0;
  }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-header">
  <div class="dashboard-title">
    <div>
      <h2>Dashboard</h2>
      <p class="muted">Network Operations Center Toolkit — Monitor, manage, and maintain your infrastructure</p>
    </div>
  </div>
</div>

<!-- Quick Stats -->
<div class="quick-stats">
  <a href="{{ url_for('wlc_dashboard') }}" class="stat-card">
    <svg class="stat-icon" viewBox="0 0 20 20" fill="currentColor">
      <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
    </svg>
    <div class="stat-label">WLC Clients</div>
    <div class="stat-value" id="totalWlcClients">—</div>
    <div class="stat-subtitle">Across all controllers</div>
  </a>

  <a href="{{ url_for('wlc_inventory') }}" class="stat-card success">
    <svg class="stat-icon" viewBox="0 0 20 20" fill="currentColor">
      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
    </svg>
    <div class="stat-label">Access Points</div>
    <div class="stat-value" id="totalWlcAps">—</div>
    <div class="stat-subtitle">Active APs joined</div>
  </a>

  <a href="{{ url_for('jobs_center') }}" class="stat-card" id="jobsCard">
    <svg class="stat-icon" viewBox="0 0 20 20" fill="currentColor">
      <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z"/>
    </svg>
    <div class="stat-label">Background Jobs</div>
    <div class="stat-value" id="totalJobs">—</div>
    <div class="stat-subtitle">Running tasks</div>
  </a>

  <a href="{{ url_for('solarwinds_nodes') }}" class="stat-card info">
    <svg class="stat-icon" viewBox="0 0 20 20" fill="currentColor">
      <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z"/>
    </svg>
    <div class="stat-label">Network Nodes</div>
    <div class="stat-value" id="totalNodes">{{ total_nodes or '—' }}</div>
    <div class="stat-subtitle">In SolarWinds</div>
  </a>
</div>

<!-- Service Status Section -->
<section class="card dashboard-section">
  <h3 class="section-title">Service Status</h3>
  <p class="muted" style="margin-bottom:20px;">Monitoring services and background polling tasks</p>

  <div class="service-status-grid">
    <a href="{{ url_for('wlc_dashboard') }}" class="service-card">
      <div class="service-header">
        <span class="service-name">WLC Dashboard</span>
        <span class="badge" id="wlcDashStatus">—</span>
      </div>
      <div class="service-details">
        <div class="service-detail-row">
          <span>Interval:</span>
          <span id="wlcDashInterval">—</span>
        </div>
        <div class="service-detail-row">
          <span>Last Poll:</span>
          <span id="wlcDashLastPoll">—</span>
        </div>
      </div>
    </a>

    <a href="{{ url_for('wlc_summer_guest') }}" class="service-card">
      <div class="service-header">
        <span class="service-name">Summer Guest Monitor</span>
        <span class="badge" id="summerGuestStatus">—</span>
      </div>
      <div class="service-details">
        <div class="service-detail-row">
          <span>Schedule:</span>
          <span id="summerGuestSchedule">—</span>
        </div>
        <div class="service-detail-row">
          <span>Last Run:</span>
          <span id="summerGuestLastRun">—</span>
        </div>
      </div>
    </a>

    <a href="{{ url_for('changes_list') }}" class="service-card">
      <div class="service-header">
        <span class="service-name">Change Windows</span>
        <span class="badge" id="changeWindowsStatus">—</span>
      </div>
      <div class="service-details">
        <div class="service-detail-row">
          <span>Upcoming:</span>
          <span id="upcomingChanges">{{ upcoming_changes or 0 }}</span>
        </div>
        <div class="service-detail-row">
          <span>Total Scheduled:</span>
          <span id="totalChanges">{{ total_changes or 0 }}</span>
        </div>
      </div>
    </a>
  </div>
</section>

<!-- Quick Access Tools -->
<section class="card dashboard-section">
  <h3 class="section-title">Quick Access Tools</h3>
  <p class="muted" style="margin-bottom:20px;">Jump directly to your most-used network operations tools</p>

  <div class="tool-grid">
    <div class="tool-card">
      <div class="tool-card-icon">
        <svg width="24" height="24" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="9" cy="9" r="6"/><path d="M14 14l4 4"/>
        </svg>
      </div>
      <h3>Interface Config Search</h3>
      <p>Find interfaces by phrase and take bulk actions across switches</p>
      <a class="btn-gradient" href="{{ url_for('tool_phrase_search') }}">Open Tool</a>
    </div>

    <div class="tool-card">
      <div class="tool-card-icon">
        <svg width="24" height="24" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M10 2a8 8 0 100 16 8 8 0 000-16zM2 10h16"/>
        </svg>
      </div>
      <h3>Global Config Push</h3>
      <p>Search and safely push global configuration changes</p>
      <a class="btn-gradient" href="{{ url_for('tool_global_config') }}">Open Tool</a>
    </div>

    <div class="tool-card">
      <div class="tool-card-icon">
        <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
          <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
        </svg>
      </div>
      <h3>WLC Dashboard</h3>
      <p>Monitor wireless clients and access points with live charts</p>
      <a class="btn-gradient" href="{{ url_for('wlc_dashboard') }}">Open Tool</a>
    </div>

    <div class="tool-card">
      <div class="tool-card-icon">
        <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
          <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM14 11a1 1 0 011 1v1h1a1 1 0 110 2h-1v1a1 1 0 11-2 0v-1h-1a1 1 0 110-2h1v-1a1 1 0 011-1z"/>
        </svg>
      </div>
      <h3>AP Inventory</h3>
      <p>Query and export access point inventory from WLCs</p>
      <a class="btn-gradient" href="{{ url_for('wlc_inventory') }}">Open Tool</a>
    </div>

    <div class="tool-card">
      <div class="tool-card-icon">
        <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M17.778 8.222c-4.296-4.296-11.26-4.296-15.556 0A1 1 0 01.808 6.808c5.076-5.077 13.308-5.077 18.384 0a1 1 0 01-1.414 1.414zM14.95 11.05a7 7 0 00-9.9 0 1 1 0 01-1.414-1.414 9 9 0 0112.728 0 1 1 0 01-1.414 1.414zM12.12 13.88a3 3 0 00-4.242 0 1 1 0 01-1.415-1.415 5 5 0 017.072 0 1 1 0 01-1.415 1.415zM9 16a1 1 0 102 0 1 1 0 00-2 0z"/>
        </svg>
      </div>
      <h3>Topology Explorer</h3>
      <p>Build CDP/LLDP neighbor tables and export paths</p>
      <a class="btn-gradient" href="{{ url_for('topology_tool') }}">Open Tool</a>
    </div>

    <div class="tool-card">
      <div class="tool-card-icon">
        <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
        </svg>
      </div>
      <h3>Audit Logs</h3>
      <p>Review all configuration changes and actions taken</p>
      <a class="btn-gradient" href="{{ url_for('audit_logs') }}">Open Tool</a>
    </div>

    <div class="tool-card">
      <div class="tool-card-icon">
        <svg width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M2 5a2 2 0 012-2h12a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V5zm3.293 1.293a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 01-1.414-1.414L7.586 10 5.293 7.707a1 1 0 010-1.414zM11 12a1 1 0 100 2h3a1 1 0 100-2h-3z"/>
        </svg>
      </div>
      <h3>Bulk SSH Terminal</h3>
      <p>Execute commands on multiple devices in parallel</p>
      <a class="btn-gradient" href="{{ url_for('bulk_ssh') }}">Open Tool</a>
    </div>
  </div>
</section>

<script>
(async function(){
  try {
    const res = await fetch('/api/dashboard-stats');
    if(!res.ok) throw new Error('Failed to load');
    const data = await res.json();

    // Update WLC stats
    if(data.wlc){
      document.getElementById('totalWlcClients').textContent = (data.wlc.clients || 0).toLocaleString();
      document.getElementById('totalWlcAps').textContent = (data.wlc.aps || 0).toLocaleString();

      const wlcStatus = document.getElementById('wlcDashStatus');
      if(data.wlc.enabled){
        wlcStatus.textContent = 'Running';
        wlcStatus.className = 'badge success';
      } else {
        wlcStatus.textContent = 'Paused';
        wlcStatus.className = 'badge neutral';
      }

      document.getElementById('wlcDashInterval').textContent = (data.wlc.interval || 5) + ' min';
      document.getElementById('wlcDashLastPoll').textContent = data.wlc.last_poll || 'Never';
    }

    // Update Summer Guest status
    if(data.summer_guest){
      const summerStatus = document.getElementById('summerGuestStatus');
      if(data.summer_guest.enabled){
        summerStatus.textContent = 'Enabled';
        summerStatus.className = 'badge success';
      } else {
        summerStatus.textContent = 'Disabled';
        summerStatus.className = 'badge neutral';
      }
      document.getElementById('summerGuestSchedule').textContent = data.summer_guest.schedule || '—';
      document.getElementById('summerGuestLastRun').textContent = data.summer_guest.last_run || 'Never';
    }

    // Update Jobs count
    if(data.jobs !== undefined){
      document.getElementById('totalJobs').textContent = data.jobs;
      const jobsCard = document.getElementById('jobsCard');
      if(data.jobs > 0){
        jobsCard.classList.add('warning');
      }
    }

    // Update change windows
    const changeStatus = document.getElementById('changeWindowsStatus');
    if(data.upcoming_changes > 0){
      changeStatus.textContent = data.upcoming_changes + ' upcoming';
      changeStatus.className = 'badge info';
    } else {
      changeStatus.textContent = 'None scheduled';
      changeStatus.className = 'badge neutral';
    }

  } catch(err){
    console.error('Failed to load dashboard stats:', err);
  }
})();
</script>
{% endblock %}

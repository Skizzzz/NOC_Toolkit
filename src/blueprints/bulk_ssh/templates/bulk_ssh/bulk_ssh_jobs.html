{% extends "base.html" %}
{% block title %}Bulk SSH Jobs{% endblock %}
{% block head_extra %}
<style>
  .page-header{
    background: linear-gradient(135deg, rgba(79,70,229,0.1) 0%, rgba(6,182,212,0.1) 100%);
    border:1px solid var(--border);
    border-radius:12px;
    padding:24px;
    margin-bottom:24px;
  }
  .page-header h2{margin:0 0 8px 0; font-size:28px;}
  .page-header p{margin:0; font-size:15px; line-height:1.5; color:var(--muted);}

  .table-container{
    background: color-mix(in oklab, var(--card) 98%, transparent);
    border:1px solid var(--border);
    border-radius:12px;
    overflow:hidden;
  }
  .jobs-table{
    width:100%;
    border-collapse:collapse;
  }
  .jobs-table th{
    text-align:left;
    padding:14px 16px;
    background: color-mix(in oklab, var(--card) 94%, transparent);
    border-bottom:2px solid var(--border);
    font-size:12px;
    text-transform:uppercase;
    letter-spacing:.05em;
    color:var(--muted);
    font-weight:600;
  }
  .jobs-table td{
    padding:14px 16px;
    border-bottom:1px solid var(--border);
    font-size:14px;
  }
  .jobs-table tbody tr{
    transition: background 0.15s ease;
  }
  .jobs-table tbody tr:hover{
    background: color-mix(in oklab, var(--accent) 4%, transparent);
  }
  .jobs-table tbody tr:last-child td{
    border-bottom:none;
  }

  .job-id-link{
    font-weight:600;
    color:var(--accent);
    text-decoration:none;
    transition: color 0.15s ease;
  }
  .job-id-link:hover{
    color:var(--accent-2);
    text-decoration:underline;
  }

  .status-badge{
    display:inline-flex;
    align-items:center;
    padding:4px 10px;
    border-radius:999px;
    font-size:12px;
    font-weight:600;
    text-transform:capitalize;
  }
  .status-running{
    background: color-mix(in oklab, var(--info) 15%, transparent);
    color:var(--info);
  }
  .status-completed{
    background: color-mix(in oklab, var(--success) 15%, transparent);
    color:var(--success);
  }
  .status-completed_with_errors{
    background: color-mix(in oklab, var(--warning) 15%, transparent);
    color:var(--warning);
  }

  .empty-state{
    padding:60px 20px;
    text-align:center;
  }
  .empty-state svg{
    width:64px;
    height:64px;
    margin:0 auto 20px;
    color:var(--muted);
    opacity:0.4;
  }
  .empty-state h3{
    margin:0 0 8px 0;
    font-size:18px;
    color:var(--muted);
  }
  .empty-state p{
    margin:0 0 20px 0;
    font-size:14px;
    color:var(--muted);
    opacity:0.8;
  }

  .btn{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:10px 20px;
    border:none;
    border-radius:8px;
    font-size:14px;
    font-weight:500;
    cursor:pointer;
    transition: all 0.15s ease;
    text-decoration:none;
  }
  .btn-primary{
    background:var(--accent);
    color:white;
  }
  .btn-primary:hover{
    background:var(--accent-2);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px color-mix(in oklab, var(--accent) 30%, transparent);
  }

  code{
    background: color-mix(in oklab, var(--card) 90%, transparent);
    padding:2px 6px;
    border-radius:4px;
    font-size:13px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  }
</style>
{% endblock %}
{% block content %}
  <nav class="breadcrumbs">
    <a href="{{ url_for('index') }}">Dashboard</a>
    <span class="breadcrumbs-separator">/</span>
    <a href="{{ url_for('bulk_ssh.bulk_ssh') }}">Bulk SSH Terminal</a>
    <span class="breadcrumbs-separator">/</span>
    <span class="breadcrumbs-current">Job History</span>
  </nav>

  <div class="page-header">
    <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:20px; flex-wrap:wrap;">
      <div style="flex:1;">
        <h2>Bulk SSH Job History</h2>
        <p>View all past bulk SSH jobs and their results. Click any job ID to view detailed results.</p>
      </div>
      <div>
        <a href="{{ url_for('bulk_ssh.bulk_ssh') }}" class="btn btn-primary">
          <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
          </svg>
          New Job
        </a>
      </div>
    </div>
  </div>

  <div class="table-container">
    {% if jobs %}
      <table class="jobs-table">
        <thead>
          <tr>
            <th>Job ID</th>
            <th>Created</th>
            <th>Username</th>
            <th>Command</th>
            <th>Devices</th>
            <th>Success</th>
            <th>Failed</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for job in jobs %}
            <tr>
              <td>
                <a href="{{ url_for('bulk_ssh.bulk_ssh_results', job_id=job.job_id) }}" class="job-id-link">
                  {{ job.job_id[:8] }}...
                </a>
              </td>
              <td>{{ job.created }}</td>
              <td>{{ job.username }}</td>
              <td><code>{{ job.command[:50] }}{{ '...' if job.command|length > 50 else '' }}</code></td>
              <td>{{ job.device_count }}</td>
              <td style="color:var(--success); font-weight:600;">{{ job.success_count }}</td>
              <td style="color:var(--error); font-weight:600;">{{ job.failed_count }}</td>
              <td>
                <span class="status-badge status-{{ job.status }}">
                  {{ job.status }}
                </span>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="empty-state">
        <svg viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"/>
        </svg>
        <h3>No Jobs Yet</h3>
        <p>You haven't run any bulk SSH jobs yet. Click the button below to get started.</p>
        <a href="{{ url_for('bulk_ssh.bulk_ssh') }}" class="btn btn-primary">
          <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
          </svg>
          Create First Job
        </a>
      </div>
    {% endif %}
  </div>
{% endblock %}
